<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generator Kupon QR Code</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
   * {
       margin: 0;
       padding: 0;
       box-sizing: border-box;
   }
   body {
       font-family: Arial, sans-serif;
       background-color: #f5f5f5;
   }
   /* Print Area - F4 Size (330mm x 210mm, Landscape) */
   .print-area {
       width: 330mm;
       height: 195mm;
       background: white;
       margin: 10mm auto; /* Paper margin */
       box-shadow: 0 0 10px rgba(0,0,0,0.1);
       display: grid;
       grid-template-columns: repeat(6, 50mm); /* Adjusted to fit */
       grid-template-rows: repeat(6, 30mm); /* Adjusted to fit */
       column-gap: 1.5mm; /* Increased gap for cutting */
       row-gap: 1.5mm;
   }
   /* Individual coupon */
   .coupon {
       width: 50mm; /* Adjusted to fit */
       height: 30mm; /* Adjusted to fit */
       border: 1px solid #000;
       display: flex;
       align-items: center;
       justify-content: space-between;
       padding: 2mm;
       position: relative; /* For vertical line positioning */
   }
   .qr-container {
       width: 25mm;
       height: 25mm; /* Square */
   }
   .qr-container img {
       width: 100%;
       height: 100%;
   }
   .coupon-number {
       width: 24mm; /* Adjusted to fit with padding */
       text-align: center;
       font-size: 40px; /* Maximized */
       font-weight: bold;
   }
   /* Vertical line between QR and number 
   .coupon::after {
       content: '';
       position: absolute;
       left: 25mm;
       top: 1mm;
       bottom: 1mm; 
       width: 1px;
       background: #000;
   } */
   @media print {
       body {
           background: white;
           margin: 0;
       }
       /* Hide everything except print-area */
       body > *:not(.print-area) {
           display: none;
       }
       .print-area {
           margin: 10mm; /* Paper margin in print */
           box-shadow: none;
       }
   }
   @page {
       size: 330mm 195mm; /* F4 landscape */
       margin: 10mm; /* Paper margin */
   }
</style>
</head>
<body>
<div class="print-area" id="printArea">
<!-- Coupons will be generated here -->
</div>
<script>
   function parseCouponCode(code) {
       const parts = code.split('-');
       if (parts.length !== 2) {
           throw new Error(`Invalid coupon code format: ${code}`);
       }
       return {
           couponCode: code || '',
           couponNumber: parts[1] || ''
       };
   }
   function generateQRUrl(text) {
       return `https://api.qrserver.com/v1/create-qr-code/?data=${encodeURIComponent(text)}&size=100x100`; // Square QR
   }
   function getQueryParams() {
       const params = new URLSearchParams(window.location.search);
       const codes = params.get('codes') ? params.get('codes').split('--') : [];
       return codes.slice(0, 36); // Limit to 36 coupons
   }
   function generateCoupons() {
       const codes = getQueryParams();
       const printArea = document.getElementById('printArea');
       // Generate 36 coupon slots (empty if no code provided)
       let html = '';
       for (let i = 0; i < 36; i++) {
           if (codes[i]) {
               try {
                   const parsed = parseCouponCode(codes[i]);
                   const qrUrl = generateQRUrl(parsed.couponCode);
                   html += `
<div class="coupon">
<div class="qr-container">
<img src="${qrUrl}" alt="QR Code">
</div>
<div class="coupon-number">${parsed.couponNumber}</div>
</div>
                   `;
               } catch (error) {
                   console.error(error.message);
                   html += `<div class="coupon"></div>`; // Empty coupon for invalid code
               }
           } else {
               html += `<div class="coupon"></div>`; // Empty coupon
           }
       }
       printArea.innerHTML = html;
       // Trigger print preview if codes are provided
       if (codes.length > 0) {
           setTimeout(() => {
               window.print();
           }, 3000);
       }
   }
   function printCoupons() {
       const printArea = document.getElementById('printArea');
       if (!printArea.innerHTML.trim()) {
           alert('Mohon generate kupon terlebih dahulu');
           return;
       }
       window.print();
   }
   function downloadPDF() {
       const printArea = document.getElementById('printArea');
       if (!printArea.innerHTML.trim()) {
           alert('Mohon generate kupon terlebih dahulu');
           return;
       }
       const opt = {
           margin: 10, // Paper margin
           filename: 'qr-coupons.pdf',
           image: { type: 'jpeg', quality: 1.0 },
           html2canvas: {
               scale: 2,
               useCORS: true,
               backgroundColor: '#ffffff'
           },
           jsPDF: {
               unit: 'mm',
               format: [330, 210], // F4 landscape
               orientation: 'landscape'
           }
       };
       html2pdf().set(opt).from(printArea).save();
   }
   window.addEventListener('load', function() {
       generateCoupons();
       // Add buttons dynamically
       const buttonContainer = document.createElement('div');
       buttonContainer.style.margin = '20px';
       buttonContainer.className = 'button-container'; // Add class for print hiding
       const printButton = document.createElement('button');
       printButton.textContent = 'Print';
       printButton.onclick = printCoupons;
       printButton.style.marginRight = '10px';
       const downloadButton = document.createElement('button');
       downloadButton.textContent = 'Download PDF';
       downloadButton.onclick = downloadPDF;
       buttonContainer.appendChild(printButton);
       buttonContainer.appendChild(downloadButton);
       document.body.insertBefore(buttonContainer, document.getElementById('printArea'));
   });
</script>
</body>
</html>
 
